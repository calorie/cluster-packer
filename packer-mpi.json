{
  "variables": {
    "server_ip": "192.168.33.10",
    "tag": "latest",
    "user": "root"
  },
  "builders": [
    {
      "type": "docker",
      "image": "phusion/baseimage:latest",
      "export_path": "mpi.tar"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "environment_vars": [
        "HOME=/root"
      ],
      "inline": [
        "/etc/my_init.d/00_regen_ssh_host_keys.sh",
        "apt-get update -y",
        "apt-get install -y curl"
      ]
    },
    {
      "type": "chef-solo",
      "cookbook_paths": ["chef-repo/cookbooks", "chef-repo/site-cookbooks"],
      "roles_path": "chef-repo/roles",
      "run_list": ["role[mpi]"],
      "json": {
        "user": "{{user `user`}}",
        "tz": "Asia/Tokyo",
        "nfs": {
          "mount_dir": "/data",
          "server_ip": "{{user `server_ip`}}"
        }
      }
    }
  ],
  "post-processors": [
    {
      "type": "docker-import",
      "repository": "cluster/message-passing-interface",
      "tag": "{{user `tag`}}"
    }
  ]
}
